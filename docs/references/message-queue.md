# 消息队列参考

> 本文档为归档参考资料，当前 Cover 项目未使用消息队列，待未来引入异步任务处理时参考。

---

## 1. 概念说明

消息队列用于服务之间的**异步通信**，实现生产者与消费者的解耦。

### 1.1 主要作用

| 作用 | 说明 |
|------|------|
| 解耦 | 生产者无需知道消费者细节 |
| 削峰填谷 | 流量高峰时缓冲请求 |
| 异步处理 | 耗时任务后台执行 |
| 可靠投递 | 消息持久化，不丢失 |

### 1.2 常见产品

| 产品 | 特点 |
|------|------|
| RabbitMQ | 功能丰富，企业级 |
| Kafka | 高吞吐，适合日志 |
| Redis Streams | 轻量级，已有 Redis 可复用 |
| AWS SQS | 云原生，无需维护 |

---

## 2. Cover 项目潜在应用场景

### 2.1 异步图像生成

当前图像生成是同步阻塞的，高并发时可能超时：

```typescript
// 当前同步实现
const imageUrl = await imageGenerator.generateImage(request);
```

未来可改为消息队列异步处理：

```
用户请求 → 发送消息到队列 → 立即返回 jobId
后台消费者 → 处理图像生成 → 更新任务状态
前端轮询 → 获取完成结果
```

### 2.2 批量处理

```
单个请求 → 拆分为 10 个平台任务 → 分别进入队列
多个消费者并行处理 → 全部完成后聚合结果
```

---

## 3. 引入时机

- 图像生成耗时导致 HTTP 超时
- 需要支持大量并发请求
- 需要优雅处理 AI API 限流
- 需要任务重试机制

---

## 4. 参考资料

- [RabbitMQ Tutorials](https://www.rabbitmq.com/getstarted.html)
- [AWS SQS](https://aws.amazon.com/sqs/)
- [BullMQ](https://bullmq.io/) - Node.js 队列库

---

*归档时间: 2025-12-22*
