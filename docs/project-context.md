# ğŸ“˜ Cover é¡¹ç›®ä¸Šä¸‹æ–‡æ–‡æ¡£ï¼ˆProject Context Documentï¼‰

> **ç”Ÿæˆæ—¶é—´**ï¼š2025-12-23  
> **ç”¨é€”**ï¼šè·¨ä¼šè¯å¤ç”¨ã€é¡¹ç›®ç®¡ç†ä¸åç»­ Prompt æ³¨å…¥

---

## ä¸€ã€é¡¹ç›®æ¦‚è¦ï¼ˆProject Overviewï¼‰

| å­—æ®µ | å†…å®¹ |
|------|------|
| **é¡¹ç›®åç§°** | Cover |
| **é¡¹ç›®èƒŒæ™¯** | ä¸€ä¸ª AI é©±åŠ¨çš„ç¤¾äº¤åª’ä½“å°é¢ç”Ÿæˆå·¥å…·ï¼Œæ”¯æŒå¤šå¹³å°ï¼ˆå°çº¢ä¹¦ã€å¾®ä¿¡ã€æŠ–éŸ³ç­‰ï¼‰å°é¢å›¾ç‰‡è‡ªåŠ¨ç”Ÿæˆ |
| **ç›®æ ‡ä¸ç›®çš„** | å¸®åŠ©å†…å®¹åˆ›ä½œè€…å¿«é€Ÿç”Ÿæˆé«˜è´¨é‡ã€ç¬¦åˆå¹³å°ç‰¹è‰²çš„å°é¢å›¾ç‰‡ï¼Œæå‡å†…å®¹æ›å…‰ç‡ |
| **è¦è§£å†³çš„é—®é¢˜** | 1. å½“å‰æç¤ºè¯ç³»ç»Ÿç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼Œä¿®æ”¹å›°éš¾ï¼›2. ç”Ÿæˆæ•ˆæœç¼ºä¹çœŸå®æ„Ÿï¼ˆä¿¯æ‹å¹³é¢é£æ ¼ï¼‰ï¼›3. å¤šæ­¥åˆ†ç¦»å¼è°ƒç”¨å¯¼è‡´ä¸Šä¸‹æ–‡ä¸¢å¤± |
| **æ•´ä½“æ„¿æ™¯** | æˆä¸ºã€Œä¸€é”®ç”Ÿæˆä¸“ä¸šçº§ç¤¾äº¤åª’ä½“å°é¢ã€çš„æ™ºèƒ½å·¥å…·ï¼ŒAI ç†è§£ç”¨æˆ·æ„å›¾å¹¶è‡ªåŠ¨äº§å‡ºå¯ç›´æ¥ä½¿ç”¨çš„å°é¢ |

---

## äºŒã€èŒƒå›´å®šä¹‰ï¼ˆScope Definitionï¼‰

| å­—æ®µ | å†…å®¹ |
|------|------|
| **å½“å‰èŒƒå›´** | æç¤ºè¯ç³»ç»Ÿæ·±åº¦é‡æ„ï¼šåˆå¹¶ `text-analyzer` + `title-generator` ä¸ºç»Ÿä¸€çš„ `CoverCreativeDirector`ï¼Œæç¤ºè¯ç‹¬ç«‹æ–‡ä»¶åŒ– |
| **éæœ¬æ¬¡èŒƒå›´** | å‰ç«¯ UI æ”¹åŠ¨ã€æ–°å¹³å°æ”¯æŒã€ç”¨æˆ·ç³»ç»Ÿã€ä»˜è´¹åŠŸèƒ½ |
| **çº¦æŸæ¡ä»¶** | 1. ä½¿ç”¨ Gemini 3 Pro / Gemini 2.5 Flash ä½œä¸ºç†è§£ Agentï¼›2. é€šè¿‡è€å¼  API ä¸­è½¬è°ƒç”¨å›¾åƒç”Ÿæˆæ¨¡å‹ï¼›3. ä¿æŒä¸ç°æœ‰ `CoverPipeline` çš„å…¼å®¹æ€§ |

---

## ä¸‰ã€å…³é”®å®ä½“ä¸å…³ç³»ï¼ˆKey Entities & Relationshipsï¼‰

### æ ¸å¿ƒå®ä½“

| å®ä½“åç§° | èŒè´£è¯´æ˜ |
|----------|----------|
| `CoverCreativeDirector` | **[å¾…åˆ›å»º]** ç»Ÿä¸€ç†è§£ Agentï¼Œå•æ¬¡è°ƒç”¨è¿”å›å®Œæ•´æ–¹æ¡ˆï¼ˆåˆ†æ+æ–‡æ¡ˆ+è§†è§‰è§„åˆ’+å›¾åƒæç¤ºè¯ï¼‰ |
| `ImageGenerationAgent` | å›¾åƒç”Ÿæˆ Agentï¼Œè°ƒç”¨å›¾åƒæ¨¡å‹ç”Ÿæˆå°é¢å›¾ç‰‡ |
| `CoverPipeline` | æµç¨‹ç¼–æ’å™¨ï¼Œåè°ƒå„ Agent å®Œæˆå°é¢ç”Ÿæˆä»»åŠ¡ |
| `ModelRegistry` | æ¨¡å‹æ³¨å†Œè¡¨ï¼Œç®¡ç†å¯ç”¨çš„å›¾åƒç”Ÿæˆæ¨¡å‹é…ç½® |
| `Prompts Module` | **[å¾…åˆ›å»º]** æç¤ºè¯æ¨¡æ¿ç®¡ç†æ¨¡å—ï¼Œæ”¯æŒçƒ­åŠ è½½ |

### å®ä½“å…³ç³»

```
ç”¨æˆ·è¯·æ±‚
    â†“
CoverPipelineï¼ˆåè°ƒå±‚ L2ï¼‰
    â”œâ”€â†’ CoverCreativeDirectorï¼ˆåˆ†å­å±‚ L3ï¼‰
    â”‚       â””â”€â†’ GeminiProviderï¼ˆåŸå­å±‚ L4ï¼‰
    â””â”€â†’ ImageGenerationAgentï¼ˆåˆ†å­å±‚ L3ï¼‰
            â””â”€â†’ OpenAIProvider / GeminiImageProviderï¼ˆåŸå­å±‚ L4ï¼‰
```

---

## å››ã€åŠŸèƒ½æ¨¡å—æ‹†è§£ï¼ˆFunctional Decompositionï¼‰

### æ¨¡å—åˆ—è¡¨

| æ¨¡å— | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| `text-analyzer.ts` | **å¾…åºŸå¼ƒ** | å½“å‰æ–‡æœ¬åˆ†ææ¨¡å—ï¼Œæç¤ºè¯ç¡¬ç¼–ç  |
| `title-generator.ts` | **å¾…åºŸå¼ƒ** | å½“å‰æ ‡é¢˜ç”Ÿæˆæ¨¡å—ï¼Œæç¤ºè¯ç¡¬ç¼–ç  |
| `image-generator.ts` | **å¾…ä¿®æ”¹** | å›¾åƒç”Ÿæˆæ¨¡å—ï¼Œ`buildImagePrompt()` éœ€é‡æ„ |
| `creative-director.ts` | **å¾…åˆ›å»º** | ç»Ÿä¸€åˆ›æ„æ€»ç›‘ Agent |
| `prompts/` | **å¾…åˆ›å»º** | æç¤ºè¯æ¨¡æ¿ç›®å½• |

### æ¨¡å—è¯¦æƒ…ï¼šCoverCreativeDirector

| å­—æ®µ | å†…å®¹ |
|------|------|
| **è¾“å…¥** | `{ userContent: string, platform: Platform, template: StyleTemplate, coverType?: string }` |
| **è¾“å‡º** | `CreativeDirectorOutput { understanding, copy, visualPlan, imagePrompt }` |
| **æ ¸å¿ƒé€»è¾‘** | 1. åŠ è½½ç³»ç»Ÿæç¤ºè¯ + å°é¢ç±»å‹æ¨¡æ¿ + å¹³å°æŒ‡å—ï¼›2. è°ƒç”¨ Gemini ç”Ÿæˆç»“æ„åŒ– JSONï¼›3. è§£æå¹¶è¿”å› |

---

## äº”ã€æŠ€æœ¯æ–¹å‘ä¸å…³é”®å†³ç­–ï¼ˆTechnical Direction & Decisionsï¼‰

| å­—æ®µ | å†…å®¹ |
|------|------|
| **å®¢æˆ·ç«¯** | Next.js 14 (App Router) + TypeScript + TailwindCSS |
| **æœåŠ¡ç«¯** | Next.js API Routes + Node.js |
| **æ¨¡å‹/ç®—æ³•å±‚** | Gemini 2.5 Flashï¼ˆç†è§£ï¼‰+ Gemini 3 Pro Image Previewï¼ˆç”Ÿæˆï¼‰ |
| **æ•°æ®æµ** | ç”¨æˆ·è¾“å…¥ â†’ Pipeline â†’ CreativeDirector â†’ ImageGenerator â†’ æœ¬åœ°å­˜å‚¨/R2 |

### å·²åšæŠ€æœ¯å†³ç­–

| å†³ç­– | ç†ç”± |
|------|------|
| æç¤ºè¯ä½¿ç”¨ `.txt` æ–‡ä»¶å­˜å‚¨ | æ”¯æŒçƒ­æ›´æ–°ï¼Œæ— éœ€é‡æ–°éƒ¨ç½²å³å¯è¿­ä»£æç¤ºè¯ |
| åˆå¹¶ `TextAnalyzer` + `TitleGenerator` | å‡å°‘ LLM è°ƒç”¨æ¬¡æ•°ï¼Œä¿ç•™å®Œæ•´ä¸Šä¸‹æ–‡ |
| ä½¿ç”¨ä¸­æ–‡æç¤ºè¯ä¸ºä¸» | ä¸­æ–‡æ–‡å­—æ¸²æŸ“è´¨é‡æ›´é«˜ï¼ˆè‹±æ–‡æç¤ºè¯ä¼šå¯¼è‡´ä¹±ç ï¼‰ |
| å•æ¬¡è°ƒç”¨è¿”å›ç»“æ„åŒ– JSON | ä¸€æ¬¡è·å–æ‰€æœ‰éœ€è¦çš„ä¿¡æ¯ï¼Œé¿å…å¤šè½®å¯¹è¯ |

### æ¶æ„åŸåˆ™

éµå¾ªã€ŒåŸå­åŒ–4å±‚æ¶æ„ã€ï¼š
- **L1 å…¥å£å±‚**ï¼šAPI Routes
- **L2 åè°ƒå±‚**ï¼šCoverPipeline
- **L3 åˆ†å­å±‚**ï¼šå„ Agentï¼ˆCreativeDirector, ImageGeneratorï¼‰
- **L4 åŸå­å±‚**ï¼šProvidersï¼ˆGemini, OpenAI, Replicateï¼‰

**æ ¸å¿ƒè§„åˆ™**ï¼šåŒå±‚æ¨¡å—ç¦æ­¢ç›¸äº’è°ƒç”¨

---

## å…­ã€å½“å‰è¿›å±•æ€»ç»“ï¼ˆCurrent Statusï¼‰

### å·²å®Œæˆ

- [x] ç ”ç©¶ RedInk é¡¹ç›®æç¤ºè¯è®¾è®¡
- [x] ç ”ç©¶ Claude Agent SDK
- [x] åˆ†æå½“å‰ç³»ç»Ÿæç¤ºè¯ç¼ºé™·
- [x] å¯¹æ¯”æ–°æ—§æç¤ºè¯æ•ˆæœ
- [x] åˆ†æå°çº¢ä¹¦çˆ†æ¬¾å°é¢é£æ ¼
- [x] åˆ›å»ºæ·±åº¦å®ç°è®¡åˆ’
- [x] åˆ›å»ºæµ‹è¯•è„šæœ¬ `test-image-api.ts`

### å¾…ç¡®è®¤

- [ ] ç”¨æˆ·æ˜¯å¦åŒæ„åºŸå¼ƒ `text-analyzer.ts` å’Œ `title-generator.ts`
- [ ] å°é¢ç±»å‹æ¨¡æ¿æ˜¯å¦éœ€è¦å¢åŠ æ›´å¤šç±»å‹
- [ ] æ˜¯å¦éœ€è¦å¢åŠ å…¶ä»–å¹³å°æŒ‡å—

---

## ä¸ƒã€åç»­è®¡åˆ’ï¼ˆNext Stepsï¼‰

### å®ç°é¡ºåº

1. åˆ›å»º `src/lib/ai/prompts/` ç›®å½•ç»“æ„
2. åˆ›å»º `creative-director.txt` ç³»ç»Ÿæç¤ºè¯
3. åˆ›å»ºå°é¢ç±»å‹æ¨¡æ¿ï¼ˆ`visual-appetite.txt` ç­‰ï¼‰
4. åˆ›å»º `prompts/index.ts` åŠ è½½å™¨
5. åˆ›å»º `CoverCreativeDirector` Agent
6. ä¿®æ”¹ `ImageGenerationAgent`
7. ä¿®æ”¹ `CoverPipeline`
8. åˆ›å»ºæµ‹è¯•è„šæœ¬éªŒè¯æ•ˆæœ
9. ç¡®è®¤æ•ˆæœååˆ é™¤åºŸå¼ƒæ–‡ä»¶

### æ½œåœ¨é£é™©

| é£é™© | ç¼“è§£æªæ–½ |
|------|---------|
| Gemini ç»“æ„åŒ–è¾“å‡ºä¸ç¨³å®š | å¢åŠ  fallback é€»è¾‘ï¼Œä½¿ç”¨æ—§æµç¨‹å…œåº• |
| æç¤ºè¯æ–‡ä»¶åŠ è½½æ€§èƒ½ | ç”Ÿäº§ç¯å¢ƒå¯ç”¨ç¼“å­˜ |
| ä¸­æ–‡æ–‡å­—æ¸²æŸ“è´¨é‡æ³¢åŠ¨ | åœ¨æç¤ºè¯ä¸­å¼ºè°ƒã€Œæ–‡å­—æ¸…æ™°ã€æ— é”™åˆ«å­—ã€ |

---

## å…«ã€ç›¸å…³èµ„æºï¼ˆReferencesï¼‰

| èµ„æº | è·¯å¾„ |
|------|------|
| å®ç°è®¡åˆ’ | [implementation_plan.md](file:///C:/Users/29913/.gemini/antigravity/brain/dca1c343-cbac-47ff-95fd-da8ef4f13682/implementation_plan.md) |
| RedInk å‚è€ƒé¡¹ç›® | `D:\C_Projects\Cover\RedInk` |
| æµ‹è¯•è„šæœ¬ | [test-image-api.ts](file:///d:/C_Projects/Cover/scripts/test-image-api.ts) |
| Claude Agent SDK | https://platform.claude.com/docs/en/agent-sdk/overview |

---

## ä¹ã€åç»­åˆå§‹åŒ– Prompt

```markdown
# Cover é¡¹ç›®ä¸Šä¸‹æ–‡

## å½“å‰ä»»åŠ¡
æç¤ºè¯ç³»ç»Ÿæ·±åº¦é‡æ„

## å¾…åˆ›å»ºæ–‡ä»¶
- src/lib/ai/prompts/creative-director.txt
- src/lib/ai/prompts/cover-types/visual-appetite.txt
- src/lib/ai/agents/creative-director.ts

## å¾…ä¿®æ”¹æ–‡ä»¶
- src/lib/ai/agents/image-generator.ts
- src/lib/ai/pipeline/cover-pipeline.ts

## å¾…åºŸå¼ƒæ–‡ä»¶
- src/lib/ai/agents/text-analyzer.ts
- src/lib/ai/agents/title-generator.ts

## æ¶æ„åŸåˆ™
éµå¾ªã€ŒåŸå­åŒ–4å±‚æ¶æ„ã€ï¼šL1å…¥å£å±‚ â†’ L2åè°ƒå±‚ â†’ L3åˆ†å­å±‚ â†’ L4åŸå­å±‚
åŒå±‚æ¨¡å—ç¦æ­¢ç›¸äº’è°ƒç”¨

è¯·ç»§ç»­æ‰§è¡Œå®ç°è®¡åˆ’ã€‚
```
